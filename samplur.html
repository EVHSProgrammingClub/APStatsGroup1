<!DOCTYPE html>
<html style="scroll-behavior: smooth;">

<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>Samplur</title>
  <meta name="description" content="">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="style.css">
</head>

<style>
  @import url("https://fonts.googleapis.com/css2?family=Montserrat:wght@500&display=swap");
  html{-webkit-font-smoothing:antialiased}body{background-color:#111;font-family:"Titillium Web",sans-serif}@media screen and (min-width: 40em){body{font-size:1.25em}}.form .label,.form .checkbox-input + label,.form .option-input + label,.form .text-input,.form .textarea,.form .select,.customSelect,.form .message,.form .button{padding:.75em 1em;-webkit-appearance:none;-moz-appearance:none;appearance:none;outline:none;line-height:normal;border-radius:0;border:none;background:none;display:block}.form .label{color:#fff;padding-top:0;padding-left:0;letter-spacing:.025em;font-size:1.125em;line-height:1.25;position:relative;z-index:100}.required .form .label:after,.form .required .label:after{content:" *";color:#E8474C;font-weight:400;font-size:.75em;vertical-align:top}.form .checkbox-input + label,.form .option-input + label,.form .text-input,.form .textarea,.form .select,.customSelect{font:inherit;line-height:normal;width:100%;box-sizing:border-box;background:#222;color:#fff;position:relative}.form .checkbox-input + label:placeholder,.form .option-input + label:placeholder,.form .text-input:placeholder,.form .textarea:placeholder,.form .select:placeholder,.customSelect:placeholder{color:#fff}.form .checkbox-input + label:-webkit-autofill,.form .option-input + label:-webkit-autofill,.form .text-input:-webkit-autofill,.form .textarea:-webkit-autofill,.form .select:-webkit-autofill,.customSelect:-webkit-autofill{box-shadow:0 0 0 1000px #111 inset;-webkit-text-fill-color:#fff;border-top-color:#111;border-left-color:#111;border-right-color:#111}.form .checkbox-input + label:not(:focus):not(:active).error,.form .option-input + label:not(:focus):not(:active).error,.form .text-input:not(:focus):not(:active).error,.form .textarea:not(:focus):not(:active).error,.form .select:not(:focus):not(:active).error,.customSelect:not(:focus):not(:active).error,.error .form .checkbox-input + label:not(:focus):not(:active),.form .error .checkbox-input + label:not(:focus):not(:active),.error .form .option-input + label:not(:focus):not(:active),.form .error .option-input + label:not(:focus):not(:active),.error .form .text-input:not(:focus):not(:active),.form .error .text-input:not(:focus):not(:active),.error .form .textarea:not(:focus):not(:active),.form .error .textarea:not(:focus):not(:active),.error .form .select:not(:focus):not(:active),.form .error .select:not(:focus):not(:active),.error .customSelect:not(:focus):not(:active){background-size:8px 8px;background-image:linear-gradient(135deg,rgba(232,71,76,0.5),rgba(232,71,76,0.5) 25%,transparent 25%,transparent 50%,rgba(232,71,76,0.5) 50%,rgba(232,71,76,0.5) 75%,transparent 75%,transparent);background-repeat:repeat}.form:not(.has-magic-focus) .checkbox-input + label:active,.form:not(.has-magic-focus) .option-input + label:active,.form:not(.has-magic-focus) .text-input:active,.form:not(.has-magic-focus) .textarea:active,.form:not(.has-magic-focus) .select:active,.form:not(.has-magic-focus) .customSelect:active,.form:not(.has-magic-focus) .customSelect.customSelectFocus,.form:not(.has-magic-focus) .checkbox-input + label:focus,.form:not(.has-magic-focus) .option-input + label:focus,.form:not(.has-magic-focus) .text-input:focus,.form:not(.has-magic-focus) .textarea:focus,.form:not(.has-magic-focus) .select:focus,.form:not(.has-magic-focus) .customSelect:focus{background:#4E4E4E}.form .message{position:absolute;bottom:0;right:0;z-index:100;font-size:.625em;color:#fff}.form .checkbox-input,.form .option-input{border:0;clip:rect(0 0 0 0);height:1px;margin:-1px;overflow:hidden;padding:0;position:absolute;width:1px}.form .checkbox-input + label,.form .option-input + label{display:inline-block;width:auto;color:#4E4E4E;position:relative;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;cursor:pointer}.form .checkbox-input:focus + label,.form .option-input:focus + label,.form .checkbox-input:active + label,.form .option-input:active + label{color:#4E4E4E}.form .checkbox-input:checked + label,.form .option-input:checked + label{color:#fff}.form .button{font:inherit;line-height:normal;cursor:pointer;background:#E8474C;color:#fff;font-weight:700;width:auto;margin-left:auto;font-weight:bold}.form .button:hover,.form .button:focus,.form .button:active{color:#fff;border-color:#fff}.form .button:active{position:relative;top:1px;left:1px}body{padding:2em}.form{max-width:40em;margin:0 auto;position:relative;display:-webkit-box;display:flex;-webkit-box-orient:horizontal;-webkit-box-direction:normal;flex-flow:row wrap;-webkit-box-pack:justify;justify-content:space-between;-webkit-box-align:end;align-items:flex-end}.form .field{width:100%;margin:0 0 1.5em}@media screen and (min-width: 40em){.form .field.half{width:calc(50% - 20px)}}.form .field.last{margin-left:auto}.form .textarea{max-width:100%}.form .select{text-indent:.01px;text-overflow:!important}.form .select::-ms-expand{display:none}.form .checkboxes,.form .options{padding:0;margin:0;list-style-type:none;overflow:hidden}.form .checkbox,.form .option{float:left;margin:1px}.customSelect{pointer-events:none}.customSelect:after{content:"";pointer-events:none;width:.5em;height:.5em;border-style:solid;border-color:#fff;border-width:0 3px 3px 0;position:absolute;top:50%;margin-top:-.625em;right:1em;-webkit-transform-origin:0 0;transform-origin:0 0;-webkit-transform:rotate(45deg);transform:rotate(45deg)}.customSelect.customSelectFocus:after{border-color:#fff}.magic-focus{position:absolute;z-index:0;width:0;pointer-events:none;background:rgba(255,255,255,0.15);-webkit-transition:top 0.2s,left 0.2s,width .2s;transition:top 0.2s,left 0.2s,width .2s;-webkit-backface-visibility:hidden;backface-visibility:hidden;-webkit-transform-style:preserve-3d;transform-style:preserve-3d;will-change:top,left,width;-webkit-transform-origin:0 0;transform-origin:0 0}
</style>

<body>
  <script src = "scripts.js"></script>
  <div style = "margin: auto; padding-top: 10px; width: 50%;">
    <p class = "form" style = "margin: auto; padding-top: 10px; width: 50%;">
      <label class='label' for='login' style = 'font-weight:bold; text-align: center; margin: auto; padding-top: 10px; width: 50%;'>Samplur</label>
    </p>
  </div>

  <br> <br>

  <form action='' class='form'>
    <p class='field required'>
      <label class='label'>Sample Size</label>
      <input class='text-input' id='sample_size' required type='number' value=''>
    </p>
    <p class='field half required'>
      <label class='label'>Buckets (Amount of Bars)</label>
      <input class='text-input' id='buckets' required type='number'>
    </p>
    <p class='field half required'>
      <label class='label'>Repetitions (Amount of Means)</label>
      <input class='text-input' id='repetitions' required type='number'>
    </p>
    <p class='field half required'>
      <label class='label' for='about'>Values (One Line Per Entry)</label>
      <textarea class='textarea' cols='10' id='values' rows='5' required type='text'></textarea>
    </p>
    <p class='field half required'>
      <label class='label' for='about'>Percentages (One Line Per Entry, Decimal Form)</label>
      <textarea class='textarea' cols='10' id='percents' rows='5' required type='text'></textarea>
    </p>
    <div style = "margin: auto; padding-top: 10px; width: 50%;">
      <p class = "form" style = "margin: auto; padding-top: 10px; width: 50%;">
        <input class='button' id = "button" onclick="buttonClick()" value='Test!' style = 'font-weight:bold; text-align: center; margin: auto; padding-top: 10px; width: 50%;'>
      </p>
    </div>
  </form>

  <div style = "margin: auto; padding-top: 10px; width: 50%;">
    <p class = "form" style = "margin: auto; padding-top: 10px; width: 50%;">
      <label class='label' id = "mean" style = 'font-weight:bold; text-align: center; margin: auto; padding-top: 10px;'>mean</label>
    </p>
  </div>

  <div style = "margin: auto; padding-top: 10px; width: 50%;">
    <p class = "form" style = "margin: auto; padding-top: 10px; width: 50%;">
      <label class='label' id='stdev' style = 'font-weight:bold; text-align: center; margin: auto; padding-top: 10px;'>stdev</label>
    </p>
  </div>


  <div style="width=100;height=400; padding-top=100%">
    <canvas id="graph"></canvas>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@2.8.0"></script>
  </div>
</body>

<script>
var created = false;

function buttonClick() {
    var repetitions = document.getElementById("repetitions").value;
    var size = document.getElementById("sample_size").value;
    var values = document.getElementById("values").value
    var percentages = document.getElementById("percents").value
    var data = parse_data(values, percentages, size);
    if (repetitions == "" || size == "") {
      alert("Make sure that every box is filled out. Please retry.")
      return;
    } else if (data == -1) {
      alert("Number of data and percents do not match. Please retry.")
      return;
    }
    var buckets = document.getElementById("buckets").value;
    var means = generate_means(size, data, repetitions);
    calculate(means)
    var dict = generate_axes(means, buckets)
    x = dict["x"];
    y = dict["y"];

    if (created) {
      graph.destroy()
    }
    graph = generate_graph(x,y);

    window.scrollTo(0,document.body.scrollHeight-100);
    document.getElementById("button").value = "Resubmit!"
    created = true
  return false;
}

function calculate(means) {
  avg = means.reduce((a, b) => a + b, 0)/means.length;
  var sqr_diffs = means.map(function(value){
    var diff = value - avg;
    var sqr_diff = diff * diff;
    return sqr_diff;
});
document.getElementById("mean").innerHTML = "Mean: " + avg;
  document.getElementById("stdev").innerHTML = "Standard Dev: " + Math.sqrt(sqr_diffs.reduce((a, b) => a + b, 0)/sqr_diffs.length)
}

function parse_data(values, percents) {
  v = values.split("\n").map(Number)
  p = percents.split("\n").map(Number)
  data = []
  if (v.length != p.length) {
    return -1;
  }
  var l = v.length;
  var sum = p.reduce((a, b) => a + b, 0);
  for (i = 0; i < l; i++) {
    p[i] = (p[i] / sum * 100).toFixed(2)*100
  }
  for (i in p) {
    counter = 0
    while (counter < p[i]) {
      data.push(v[i])
      counter += 1
    }
  }
  return data;
}

function generate_means(sample_size, data, repetitions) {
  means = []

  while (means.length < repetitions) {
    var sum = 0
    for (i = 0; i < sample_size; i++) {
      sum += Number(data[Math.floor(Math.random() * data.length)]);
    }
    means[means.length] = sum / sample_size;
  }
  means = means.sort((a, b) => a - b);
  return means;
}

function generate_axes(means, buckets) {
  max_mean = Math.max(...means)
  min_mean = Math.min(...means)

  console.log(means)
  console.log(max_mean)
  console.log(min_mean)
  bucket_size = (max_mean - min_mean) / buckets
  console.log(bucket_size)

  x = [];
  y = [];

  i = 0;

  for (b = 0; b < buckets; b++) {
    start = b * bucket_size + min_mean;
    end = (b + 1) * bucket_size + min_mean;
    x[x.length] = start.toFixed(2) + "-" + end.toFixed(2);
    y[y.length] = 0;

    while (i <= means.length && means[i] <= end) {
      y[b] = y[b] + 1;
      i = i + 1;
    }
  }

  return {
    "x": x,
    "y": y
  }
}

function generate_graph(x, y) {
  var ctx = document.getElementById('graph').getContext('2d');
  var myChart = new Chart(ctx, {
    type: 'bar',
    data: {
      labels: x,
      fontColor: "white",
      datasets: [{
        label: 'Means',
        data: y,
        backgroundColor: 'rgba(255, 99, 132, 0.2)',
        borderColor: 'rgba(255, 99, 132, 1)',
        borderWidth: 1
      }]
    },
    options: {
      title: {
        display: true,
        fontColor: "white",
        text: "Frequency of Means"
      },
      scales: {
        yAxes: [{
          ticks: {
            beginAtZero: true
          }
        }]
      }
    }
  });
  return myChart;
}
</script>

</html>
